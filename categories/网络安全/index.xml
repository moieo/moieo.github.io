<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>网络安全 on 晴雨笔记</title><link>https://blog.moieo.net/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/</link><description>Recent content in 网络安全 on 晴雨笔记</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Sun, 31 Jul 2022 22:59:35 +0800</lastBuildDate><atom:link href="https://blog.moieo.net/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/index.xml" rel="self" type="application/rss+xml"/><item><title>SQLMap进行SQL注入测试</title><link>https://blog.moieo.net/2022/07/31/225935/</link><pubDate>Sun, 31 Jul 2022 22:59:35 +0800</pubDate><guid>https://blog.moieo.net/2022/07/31/225935/</guid><description>&lt;img src="https://static.983577.xyz/images/2022/08/Screenshot_2022-07-31-23-03-10-552_com.termux.webp" alt="Featured image of post SQLMap进行SQL注入测试" /&gt;&lt;blockquote&gt;
&lt;p&gt;提示： 仅供学习使用，严禁用于违法用途&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="介绍"&gt;介绍
&lt;/h2&gt;&lt;h3 id="简介"&gt;简介
&lt;/h3&gt;&lt;p&gt;SQLMap 是一个开源的渗透测试工具，可以用来自动化检测，利用 SQL 注入漏洞，获取数据库的权限。
它的检测引擎非常强大，针对不同类型的数据库有不同的方案和选项，获取数据库中存储的数据。&lt;/p&gt;
&lt;p&gt;目前支持 MySQL、Oracle、PostgreSQL、Microsoft SQL Server、Microsoft Access 等数据库&lt;/p&gt;
&lt;h3 id="输出级别"&gt;输出级别
&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;0：只显示 python 错误以及严重的信息
1：同时显示基本信息和警告信息（默认）
2：同时显示 debug 信息
3：同时显示注入的 payload
4：同时显示 HTTP 请求
5：同时显示 HTTP 响应头
6：同时显示 HTTP 响应页面&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="安装"&gt;安装
&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;注：安装 SQLMap 需要 Python 环境
{% link &lt;a class="link" href="https://sqlmap.org" target="_blank" rel="noopener"
&gt;https://sqlmap.org&lt;/a&gt; SQLMap官网 %}&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;克隆仓库&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;git clone --depth &lt;span class="m"&gt;1&lt;/span&gt; https://github.com/sqlmapproject/sqlmap.git sqlmap
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; sqlmap
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;python sqlmap.py
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;你也可以将它配置到环境变量中，具体方法请上搜索引擎找
&lt;img src="https://static.983577.xyz/images/2022/08/Screenshot_2022-07-31-23-03-10-552_com.termux.webp"
loading="lazy"
alt="运行图"
&gt;
我这边配置了环境变量，所以可直接执行&lt;/p&gt;
&lt;h2 id="使用"&gt;使用
&lt;/h2&gt;&lt;h3 id="1-检查是否存在注入"&gt;1. 检查是否存在注入
&lt;/h3&gt;&lt;p&gt;例如注入目标为：http://127.0.0.1:8080/?id=1
则命令如下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;python sqlmap.py -u &lt;span class="s2"&gt;&amp;#34;http://127.0.0.1:8080/?id=1&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;执行过程如下
&lt;img src="https://static.983577.xyz/images/2022/08/Screenshot_2022-08-02-17-42-02-095_com.termux.webp"
loading="lazy"
alt="执行过程"
&gt;
执行完毕后，可看到数据库类型，如果服务器后端使用的是 PHP 语言，会显示 PHP 的版本
&lt;img src="https://static.983577.xyz/images/2022/08/Screenshot_2022-08-02-17-44-29-937-edit_com.termux.webp"
loading="lazy"
alt="执行完毕"
&gt;
如图所示，数据库类型为 &lt;code&gt;MySQL&lt;/code&gt;
PHP 版本为 &lt;code&gt;8.1.8&lt;/code&gt;&lt;/p&gt;
&lt;h3 id="2-查询当前用户下所有数据库"&gt;2. 查询当前用户下所有数据库
&lt;/h3&gt;&lt;p&gt;用途：该命令在确定网站存在 SQL 注入漏洞时，用于查询当前用户下的数据库&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;python sqlmap.py -u &lt;span class="s2"&gt;&amp;#34;http://127.0.0.1:8080/?id=1&amp;#34;&lt;/span&gt; --dbs
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src="https://static.983577.xyz/images/2022/08/Screenshot_2022-08-02-18-17-26-936_com.termux.webp"
loading="lazy"
alt="所有数据库"
&gt;
运行结束后可看到一些 数据库 的名称，它们将以&lt;code&gt;[*]&lt;/code&gt;开头
&lt;code&gt;--dbs&lt;/code&gt;参数缩写成&lt;code&gt;-D xxx&lt;/code&gt;，该参数为查询&lt;code&gt;xxx&lt;/code&gt;数据库下的内容&lt;/p&gt;
&lt;h3 id="3-获取数据库中的表名"&gt;3. 获取数据库中的表名
&lt;/h3&gt;&lt;p&gt;用途：该命令在确定网站存在 SQL 注入漏洞时，可获取数据库下所有表的名称&lt;/p&gt;
&lt;p&gt;&lt;code&gt;-D&lt;/code&gt; 参数用来指定数据库，例如 &lt;code&gt;-D moieo&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;python sqlmap.py -u http://127.0.0.1:8080/?id&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; -D moieo --tables
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src="https://static.983577.xyz/images/2022/08/Screenshot_2022-08-02-18-21-55-513_com.termux.webp"
loading="lazy"
alt="所有数据表"
&gt;
运行结束后可看到所有数据表的名称，继续注入可使用 &lt;code&gt;-T&lt;/code&gt; 参数，该参数为 &lt;code&gt;--tables&lt;/code&gt;的缩写，用于指定数据表继续注入获取数据&lt;/p&gt;
&lt;h3 id="4-获取数据表的字段名"&gt;4. 获取数据表的字段名
&lt;/h3&gt;&lt;p&gt;用途：在查询完表名后，指定数据库和数据表进行注入测试，获取该表下所有字段&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;python sqlmap.py -u http://127.0.0.1:8080/?id&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; -D moieo -T moieo_comments --columns
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src="https://static.983577.xyz/images/2022/08/Screenshot_2022-08-02-18-28-17-588_com.termux.webp"
loading="lazy"
alt="所有字段"
&gt;
运行结束后得到所有字段&lt;/p&gt;
&lt;h3 id="5-获取数据表内存储的数据"&gt;5. 获取数据表内存储的数据
&lt;/h3&gt;&lt;p&gt;用途：在获取并确定数据表内有字段时使用，可获得数据表内存储的数据&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;python sqlmap.py -u http://127.0.0.1:8080/?id&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; -D moieo -T moieo_comments --dump
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src="https://static.983577.xyz/images/2022/08/Screenshot_2022-08-02-18-32-38-680_com.termux.webp"
loading="lazy"
alt="表内的所有数据"
&gt;
可以看到，执行结束后可获得数据表内每个字段的数据&lt;/p&gt;
&lt;h2 id="其他选项"&gt;其他选项
&lt;/h2&gt;&lt;h3 id="1-获取数据库所有用户"&gt;1. 获取数据库所有用户
&lt;/h3&gt;&lt;p&gt;在有权管理所有用户的情况下 &lt;code&gt;--users&lt;/code&gt; 选项可获得数据库所有用户名&lt;/p&gt;
&lt;h3 id="2-获取数据库用户的密码"&gt;2. 获取数据库用户的密码
&lt;/h3&gt;&lt;p&gt;在有权管理所有用户的情况下 &lt;code&gt;--passwords&lt;/code&gt; 选项可获得所有用户的密码，该选项获得到的数据是经过哈希算法加密的
可以尝试使用 &lt;a class="link" href="https://www.cmd5.com/" target="_blank" rel="noopener"
&gt;https://www.cmd5.com/&lt;/a&gt; 硬解&lt;/p&gt;
&lt;h3 id="3-获取当前网站数据库的名称"&gt;3. 获取当前网站数据库的名称
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;--current-db&lt;/code&gt; 选项，可获得当前网站数据库的名称&lt;/p&gt;
&lt;h3 id="4-获取当前网站数据库使用的用户名称"&gt;4. 获取当前网站数据库使用的用户名称
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;--current-user&lt;/code&gt; 选项，用于获取当前用户名称&lt;/p&gt;
&lt;h3 id="杂项"&gt;杂项
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;--is-dba&lt;/code&gt; 用于判断用户是否管理员权限&lt;/p&gt;
&lt;p&gt;&lt;code&gt;--roles&lt;/code&gt; 列出数据库管理员角色&lt;/p&gt;
&lt;p&gt;&lt;code&gt;--referer&lt;/code&gt;，当&lt;code&gt;--level&lt;/code&gt;的参数为 3 或以上，用于指定来源网站，欺骗目标网站，参数为 URL&lt;/p&gt;
&lt;p&gt;&lt;code&gt;--sql-shell&lt;/code&gt; 运行自定义 SQL 语句&lt;/p&gt;
&lt;p&gt;&lt;code&gt;--os-cmd&lt;/code&gt; 或 &lt;code&gt;--os-shell&lt;/code&gt; 执行任意操作系统命令&lt;/p&gt;
&lt;p&gt;&lt;code&gt;--file-write xxx.php --file-dest xxx.php&lt;/code&gt; 上传文件到数据库服务器，前者为源文件路径，后者为目标数据库服务器的文件路径&lt;/p&gt;
&lt;p&gt;&lt;code&gt;--file-read&lt;/code&gt; 从数据库服务器中读取文件，参数为数据库服务器中的文件路径&lt;/p&gt;</description></item></channel></rss>